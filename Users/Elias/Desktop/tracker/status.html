<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ordrestatus - Din bestilling</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="assets/css/style.css">
</head>
<body class="bg-light">
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card shadow border-0 rounded-4">
                    <div class="card-body p-4">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <div>
                                <h1 class="h3">Din ordrestatus</h1>
                                <p class="text-muted mb-0" id="receiptNumber">Kvitteringsnummer: </p>
                            </div>
                            <a href="index.html" class="btn btn-outline-primary">
                                <i class="bi bi-arrow-left me-2"></i>Tilbake
                            </a>
                        </div>
                        
                        <div class="order-progress mt-5">
                            <div class="row text-center position-relative progress-track">
                                <!-- Progress track with lines connecting the steps -->
                                <div class="col-4">
                                    <div class="progress-step" id="step1">
                                        <div class="progress-icon">
                                            <i class="bi bi-cart-check"></i>
                                        </div>
                                        <h5 class="mt-3">Bestilling mottatt</h5>
                                        <p class="text-muted small" id="date1"></p>
                                    </div>
                                </div>
                                
                                <div class="col-4">
                                    <div class="progress-step" id="step2">
                                        <div class="progress-icon">
                                            <i class="bi bi-gear"></i>
                                        </div>
                                        <h5 class="mt-3">Produksjon igangsatt</h5>
                                        <p class="text-muted small" id="date2"></p>
                                    </div>
                                </div>
                                
                                <div class="col-4">
                                    <div class="progress-step" id="step3">
                                        <div class="progress-icon">
                                            <i class="bi bi-box"></i>
                                        </div>
                                        <h5 class="mt-3">Ordre sendt</h5>
                                        <p class="text-muted small" id="date3"></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="order-details mt-5">
                            <div class="card bg-light">
                                <div class="card-body">
                                    <h5>Detaljer</h5>
                                    <div id="orderComment" class="mb-3"></div>
                                    
                                    <div id="shippingDetails" class="d-none">
                                        <h6>Forsendelsesdetaljer:</h6>
                                        <p class="mb-1" id="trackingNumber"></p>
                                        <p class="mb-1" id="zipCode"></p>
                                        <p class="mb-0" id="city"></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/main.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Get the current order from session storage
            const orderData = sessionStorage.getItem('currentOrder');
            
            if (!orderData) {
                window.location.href = 'index.html';
                return;
            }
            
            const order = JSON.parse(orderData);
            displayOrderStatus(order);
        });
        
        function displayOrderStatus(order) {
            // Set receipt number
            document.getElementById('receiptNumber').textContent = 'Kvitteringsnummer: ' + order.receiptNumber;
            
            // Determine current stage (1-3)
            let currentStage = 1;
            if (order.status === 'production') {
                currentStage = 2;
            } else if (order.status === 'shipped') {
                currentStage = 3;
            }
            
            // Update progress steps
            for (let i = 1; i <= 3; i++) {
                const step = document.getElementById('step' + i);
                if (i <= currentStage) {
                    step.classList.add('completed');
                }
            }
            
            // Update dates if available
            if (order.receivedDate) {
                document.getElementById('date1').textContent = formatDate(order.receivedDate);
            }
            
            if (order.productionDate) {
                document.getElementById('date2').textContent = formatDate(order.productionDate);
            }
            
            if (order.shippedDate) {
                document.getElementById('date3').textContent = formatDate(order.shippedDate);
            }
            
            // Update comments if available
            if (order.comment) {
                document.getElementById('orderComment').innerHTML = `<p><strong>Kommentar:</strong> ${order.comment}</p>`;
            }
            
            // Show tracking details if shipped
            if (order.status === 'shipped') {
                document.getElementById('shippingDetails').classList.remove('d-none');
                
                if (order.trackingNumber) {
                    document.getElementById('trackingNumber').innerHTML = `<strong>Sporingsnummer:</strong> ${order.trackingNumber}`;
                }
                
                if (order.zipCode) {
                    document.getElementById('zipCode').innerHTML = `<strong>Postnummer:</strong> ${order.zipCode}`;
                }
                
                if (order.city) {
                    document.getElementById('city').innerHTML = `<strong>By:</strong> ${order.city}`;
                }
            }
        }
        
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('no-NO');
        }
    </script>
</body>
</html>